<!DOCTYPE html>
<html lang="en">
  <!-- Page Setup -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enterprise Portal - Secure Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- Toast notifications -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  </head>

  <!-- Main Page Body -->
  <body
    class="bg-gradient-to-br from-slate-50 via-emerald-50 to-green-50 min-h-screen flex items-center justify-center antialiased">
    <!-- Accessibility skip link -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-emerald-600 text-white px-4 py-2 rounded-lg z-50"
      >Skip to main content</a
    >

    <!-- Main Container -->
    <div
      class="w-full max-w-sm mx-auto px-6 py-8"
      role="main"
      id="main-content">
      <!-- Logo and Title -->
      <header class="text-center mb-10">
        <div class="w-20 h-20 mx-auto mb-6">
          <div
            class="bg-gradient-to-br from-emerald-600 to-green-700 rounded-2xl w-full h-full flex items-center justify-center shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40 transition-shadow duration-300">
            <i
              class="fas fa-building text-white text-4xl drop-shadow-sm"
              aria-hidden="true"></i>
          </div>
        </div>
        <h1
          class="text-2xl font-bold text-slate-800 tracking-tight mb-3"
          id="page-title">
          Welcome Back
        </h1>
        <p class="text-slate-600 text-base font-medium" id="page-description">
          Access your enterprise dashboard
        </p>
      </header>

      <!-- Main Login Form -->
      <main
        class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/50 p-8 relative overflow-hidden mb-10">
        <div
          class="absolute inset-0 bg-gradient-to-br from-white/60 to-white/30 rounded-3xl"></div>

        <div class="relative z-10">
          <form
            id="loginForm"
            class="space-y-6"
            role="form"
            aria-labelledby="page-title"
            aria-describedby="page-description">
            <!-- Email Field -->
            <div class="relative input-group">
              <!-- Icon -->
              <div
                class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 peer-focus:text-emerald-600 transition-colors duration-300">
                <i class="fas fa-envelope"></i>
              </div>
              <input
                type="email"
                id="email"
                name="email"
                autocomplete="email"
                aria-describedby="email-error"
                aria-required="true"
                class="w-full pl-12 pr-4 py-4 bg-slate-50/80 border-2 border-slate-200 rounded-xl outline-none text-slate-900 font-medium text-base transition-all duration-300 focus:bg-white focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 hover:border-slate-300 peer"
                required />
              <label
                for="email"
                class="floating-label absolute left-12 top-4 text-slate-500 pointer-events-none origin-left font-medium transition-all duration-300 peer-focus:text-emerald-600 peer-focus:font-semibold"
                >Email address</label
              >
              <div
                class="error-message hidden text-red-500 text-sm mt-3 font-medium opacity-0 transition-all duration-300"
                id="email-error"
                role="alert"
                aria-live="polite"></div>
            </div>

            <!-- Password Field -->
            <div class="relative input-group">
              <input
                type="password"
                id="password"
                name="password"
                autocomplete="current-password"
                aria-describedby="password-error"
                aria-required="true"
                class="w-full px-4 py-4 pr-12 bg-slate-50/80 border-2 border-slate-200 rounded-xl outline-none text-slate-900 font-medium text-base transition-all duration-300 focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/30 focus:shadow-lg hover:border-slate-300 hover:bg-white peer"
                required />
              <label
                for="password"
                class="floating-label absolute left-4 top-4 text-slate-500 pointer-events-none origin-left font-medium transition-all duration-300 peer-focus:text-emerald-600 peer-focus:font-semibold"
                >Password</label
              >
              <button
                type="button"
                id="togglePassword"
                aria-label="Toggle password visibility"
                aria-pressed="false"
                aria-describedby="password"
                class="absolute right-4 top-4 text-slate-500 hover:text-slate-700 transition-all duration-200 p-1 hover:bg-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:bg-slate-100">
                <i
                  id="eyeOpen"
                  class="fas fa-eye text-lg"
                  aria-hidden="true"></i>
                <i
                  id="eyeClosed"
                  class="fas fa-eye-slash text-lg hidden"
                  aria-hidden="true"></i>
              </button>
              <div
                class="error-message hidden text-red-500 text-sm mt-3 font-medium opacity-0 transition-all duration-300"
                id="password-error"
                role="alert"
                aria-live="polite"></div>
            </div>

            <!-- Remember Me and Forgot Password -->
            <div class="flex items-center justify-between pt-2">
              <label class="flex items-center cursor-pointer group">
                <input
                  type="checkbox"
                  id="rememberMe"
                  class="w-4 h-4 text-emerald-600 border-slate-300 rounded focus:ring-emerald-500 focus:ring-2 focus:ring-offset-2 focus:outline-none transition-all duration-200" />
                <span
                  class="ml-3 text-sm text-slate-600 font-medium group-hover:text-slate-700 transition-colors"
                  >Remember me</span
                >
              </label>
              <button
                type="button"
                id="forgotPassword"
                class="text-sm text-emerald-600 hover:text-emerald-700 font-medium transition-all duration-200 py-2 px-3 rounded-lg hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:bg-emerald-50">
                Forgot password?
              </button>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              class="w-full bg-gradient-to-r from-emerald-600 to-green-600 text-white py-4 rounded-xl font-semibold text-base shadow-lg shadow-emerald-500/30 hover:from-emerald-700 hover:to-green-700 hover:shadow-xl hover:shadow-emerald-500/40 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-emerald-500/50 focus:ring-offset-2 transform hover:-translate-y-0.5 active:translate-y-0 mt-8">
              Sign In
            </button>
          </form>

          <!-- Social Login Divider -->
          <div class="relative mt-10 mb-8">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t border-slate-200"></div>
            </div>
            <div class="relative flex justify-center text-sm">
              <span class="px-6 bg-white text-slate-500 font-medium"
                >Or continue with</span
              >
            </div>
          </div>

          <!-- Social Login Buttons -->
          <div class="flex justify-center space-x-6">
            <button
              aria-label="Sign in with Google"
              class="w-14 h-14 bg-white border-2 border-slate-200 rounded-full flex items-center justify-center shadow-sm hover:shadow-lg hover:border-slate-300 hover:-translate-y-1 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-500/30 focus:border-blue-500 group"
              onclick="showInfoToast('Google login will be enabled soon')">
              <i
                class="fab fa-google text-slate-600 text-xl transition-transform duration-300 group-hover:scale-110"
                aria-hidden="true"></i>
            </button>
            <button
              aria-label="Sign in with Apple"
              class="w-14 h-14 bg-slate-900 border-2 border-gray-800 rounded-full flex items-center justify-center shadow-sm hover:shadow-lg hover:bg-gray-800 hover:-translate-y-1 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-gray-500/30 focus:border-gray-500 group"
              onclick="showInfoToast('Apple login will be enabled soon')">
              <i
                class="fab fa-apple text-white text-xl transition-transform duration-300 group-hover:scale-110"
                aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </main>

      <!-- Sign Up Link -->
      <footer class="text-center text-slate-600 text-base font-medium">
        Don't have an account?
        <button
          id="showSignUp"
          class="text-emerald-600 hover:text-emerald-700 font-semibold transition-all duration-200 py-2 px-2 rounded-lg hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:bg-emerald-50 ml-1">
          Sign up
        </button>
      </footer>
    </div>

    <!-- OTP Modal -->
    <div
      id="otpModal"
      class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center p-4 z-50 opacity-0 transition-all duration-300"
      role="dialog"
      aria-modal="true"
      aria-labelledby="otp-title"
      aria-describedby="otp-description">
      <div
        class="bg-white/95 backdrop-blur-xl rounded-3xl p-8 w-full max-w-sm mx-auto shadow-2xl border border-white/50 relative overflow-hidden">
        <div
          class="absolute inset-0 bg-gradient-to-br from-white/60 to-white/30 rounded-3xl"></div>

        <div class="relative z-10">
          <div class="text-center mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-3" id="otp-title">
              Enter Verification Code
            </h2>
            <p class="text-slate-600 text-sm font-medium" id="otp-description">
              We've sent a 6-digit code to your email
            </p>
          </div>

          <div
            class="grid grid-cols-6 gap-3 mb-8"
            role="group"
            aria-labelledby="otp-title">
            <input
              type="text"
              maxlength="1"
              aria-label="First digit"
              autocomplete="one-time-code"
              class="otp-input aspect-square border-2 border-slate-200 rounded-lg text-center text-lg font-bold text-slate-900 bg-slate-50/80 focus:outline-none focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/40 focus:shadow-lg transition-all duration-300" />
            <input
              type="text"
              maxlength="1"
              aria-label="Second digit"
              autocomplete="one-time-code"
              class="otp-input aspect-square border-2 border-slate-200 rounded-lg text-center text-lg font-bold text-slate-900 bg-slate-50/80 focus:outline-none focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/40 focus:shadow-lg transition-all duration-300" />
            <input
              type="text"
              maxlength="1"
              aria-label="Third digit"
              autocomplete="one-time-code"
              class="otp-input aspect-square border-2 border-slate-200 rounded-lg text-center text-lg font-bold text-slate-900 bg-slate-50/80 focus:outline-none focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/40 focus:shadow-lg transition-all duration-300" />
            <input
              type="text"
              maxlength="1"
              aria-label="Fourth digit"
              autocomplete="one-time-code"
              class="otp-input aspect-square border-2 border-slate-200 rounded-lg text-center text-lg font-bold text-slate-900 bg-slate-50/80 focus:outline-none focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/40 focus:shadow-lg transition-all duration-300" />
            <input
              type="text"
              maxlength="1"
              aria-label="Fifth digit"
              autocomplete="one-time-code"
              class="otp-input aspect-square border-2 border-slate-200 rounded-lg text-center text-lg font-bold text-slate-900 bg-slate-50/80 focus:outline-none focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/40 focus:shadow-lg transition-all duration-300" />
            <input
              type="text"
              maxlength="1"
              aria-label="Sixth digit"
              autocomplete="one-time-code"
              class="otp-input aspect-square border-2 border-slate-200 rounded-lg text-center text-lg font-bold text-slate-900 bg-slate-50/80 focus:outline-none focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/40 focus:shadow-lg transition-all duration-300" />
          </div>

          <button
            id="verifyOtp"
            class="w-full bg-gradient-to-r from-emerald-600 to-green-600 text-white py-4 rounded-xl font-semibold text-base shadow-lg shadow-emerald-500/30 hover:from-emerald-700 hover:to-green-700 hover:shadow-xl hover:shadow-emerald-500/40 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-emerald-500/50 focus:ring-offset-2 transform hover:-translate-y-0.5 active:translate-y-0 mb-6">
            Verify Code
          </button>

          <div class="text-center">
            <button
              id="resendCode"
              class="text-sm text-slate-600 hover:text-slate-700 font-medium transition-all duration-200 py-2 px-3 rounded-lg hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-slate-500/50 focus:bg-slate-100">
              Didn't receive code?
              <span class="text-emerald-600 font-semibold">Resend</span>
            </button>
          </div>

          <button
            id="closeModal"
            aria-label="Close verification code dialog"
            class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-1.5 rounded-lg hover:bg-slate-100 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-slate-500/50 focus:bg-slate-100">
            <i class="fas fa-times text-xl" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Sign Up Modal -->
    <div
      id="signUpModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 modal-backdrop z-50"
      role="dialog"
      aria-modal="true"
      aria-labelledby="signup-title"
      aria-describedby="signup-description">
      <div class="bg-white rounded-2xl p-8 max-w-md w-full modal-content mx-4">
        <header class="mb-8">
          <h2
            class="text-xl font-semibold text-gray-900 mb-3"
            id="signup-title">
            Create Account
          </h2>
          <p class="text-gray-600 text-base" id="signup-description">
            Join us today! Create your corporate account
          </p>
        </header>

        <form id="signUpForm" class="space-y-6">
          <div class="relative input-group">
            <input
              type="text"
              id="signUpFullName"
              class="input-field w-full px-4 py-3 border border-gray-300 rounded-lg outline-none text-gray-900 peer text-base"
              required />
            <label
              for="signUpFullName"
              class="floating-label absolute left-4 top-3 text-gray-500 pointer-events-none origin-left text-base transition-all duration-300"
              >Full Name</label
            >
            <div
              class="error-message hidden text-red-500 text-sm mt-3 opacity-0 transition-all duration-300"></div>
          </div>

          <div class="relative input-group">
            <input
              type="email"
              id="signUpEmail"
              class="input-field w-full px-4 py-3 border border-gray-300 rounded-lg outline-none text-gray-900 peer text-base"
              required />
            <label
              for="signUpEmail"
              class="floating-label absolute left-4 top-3 text-gray-500 pointer-events-none origin-left text-base transition-all duration-300"
              >Email address</label
            >
            <div
              class="error-message hidden text-red-500 text-sm mt-3 opacity-0 transition-all duration-300"></div>
          </div>

          <div class="relative input-group">
            <input
              type="password"
              id="signUpPassword"
              class="input-field w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg outline-none text-gray-900 peer text-base"
              required />
            <label
              for="signUpPassword"
              class="floating-label absolute left-4 top-3 text-gray-500 pointer-events-none origin-left text-base transition-all duration-300"
              >Password</label
            >
            <button
              type="button"
              id="toggleSignUpPassword"
              class="absolute right-3 top-3.5 text-gray-500 hover:text-gray-700 transition-colors p-1">
              <i
                id="signUpEyeOpen"
                class="fas fa-eye text-lg"
                aria-hidden="true"></i>
              <i
                id="signUpEyeClosed"
                class="fas fa-eye-slash text-lg hidden"
                aria-hidden="true"></i>
            </button>
            <div
              class="error-message hidden text-red-500 text-sm mt-3 opacity-0 transition-all duration-300"></div>
          </div>

          <div class="relative input-group">
            <input
              type="password"
              id="signUpConfirmPassword"
              class="input-field w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg outline-none text-gray-900 peer text-base"
              required />
            <label
              for="signUpConfirmPassword"
              class="floating-label absolute left-4 top-3 text-gray-500 pointer-events-none origin-left text-base transition-all duration-300"
              >Confirm Password</label
            >
            <button
              type="button"
              id="toggleSignUpConfirmPassword"
              class="absolute right-3 top-3.5 text-gray-500 hover:text-gray-700 transition-colors p-1">
              <i
                id="signUpConfirmEyeOpen"
                class="fas fa-eye text-lg"
                aria-hidden="true"></i>
              <i
                id="signUpConfirmEyeClosed"
                class="fas fa-eye-slash text-lg hidden"
                aria-hidden="true"></i>
            </button>
            <div
              class="error-message hidden text-red-500 text-sm mt-3 opacity-0 transition-all duration-300"></div>
          </div>

          <div class="flex items-start pt-2">
            <input
              type="checkbox"
              id="agreeTerms"
              class="w-4 h-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500 mt-0.5"
              required />
            <label for="agreeTerms" class="ml-2 text-sm text-gray-600">
              I agree to the
              <a href="#" class="text-emerald-600 hover:text-emerald-700"
                >Terms of Service</a
              >
              and
              <a href="#" class="text-emerald-600 hover:text-emerald-700"
                >Privacy Policy</a
              >
            </label>
          </div>

          <button
            type="submit"
            class="w-full bg-gradient-to-r from-emerald-600 to-green-600 text-white py-4 rounded-xl font-semibold text-base shadow-lg shadow-emerald-500/30 hover:from-emerald-700 hover:to-green-700 hover:shadow-xl hover:shadow-emerald-500/40 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-emerald-500/30 transform hover:-translate-y-0.5 active:translate-y-0 mt-8">
            Create Account
          </button>
        </form>

        <footer class="text-center mt-8 text-gray-600 text-sm">
          Already have an account?
          <button
            id="showLogin"
            class="text-emerald-600 hover:text-emerald-700 font-semibold transition-all duration-200 py-2 px-3 rounded-lg hover:bg-emerald-50">
            Sign in
          </button>
        </footer>

        <button
          id="closeSignUpModal"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 -m-2">
          <i class="fas fa-times text-xl" aria-hidden="true"></i>
        </button>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      // Settings
      const MAX_LOGIN_ATTEMPTS = 5;
      const LOCKOUT_MINUTES = 15;
      const OTP_LENGTH = 6;
      const OTP_EXPIRY_MINUTES = 5;

      // Toast config and function
      const toastTypes = {
        success: { border: '#10b981', color: '#065f46' },
        error: { border: '#dc2626', color: '#991b1b' },
        warning: { border: '#d97706', color: '#92400e' },
        info: { border: '#2563eb', color: '#1e40af' },
      };

      function showToast(message, type = 'info') {
        const { border, color } = toastTypes[type];
        Toastify({
          text: message,
          duration: 4000,
          close: true,
          gravity: 'top',
          position: 'center',
          stopOnFocus: true,
          className: 'toast-corporate',
          style: {
            background: '#fff',
            border: `2px solid ${border}`,
            borderRadius: '0.75rem',
            boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)',
            fontSize: '0.875rem',
            fontWeight: '600',
            padding: '1rem 2.5rem 1rem 1.25rem',
            maxWidth: 'min(90vw, 380px)',
            minWidth: '280px',
            color,
            fontFamily: 'system-ui, sans-serif',
            letterSpacing: '0.025em',
          },
        }).showToast();
      }

      // Shortcuts
      const showSuccessToast = (msg) => showToast(msg, 'success');
      const showErrorToast = (msg) => showToast(msg, 'error');
      const showWarningToast = (msg) => showToast(msg, 'warning');
      const showInfoToast = (msg) => showToast(msg, 'info');

      // Minimal CSS
      document.head.insertAdjacentHTML(
        'beforeend',
        `
        <style>
          .toast-corporate {
            font-family: system-ui, sans-serif !important;
            background: #fff !important;
            margin-top: 10px !important;
            word-wrap: break-word !important;
          }
          .toast-corporate:hover { transform: translateY(-1px) !important; }
          .toast-corporate .toast-close {
            position: absolute !important;
            top: 6px !important; right: 8px !important;
            background: rgba(100,116,139,0.1) !important;
            border: none !important; border-radius: 0.375rem !important;
            width: 22px !important; height: 22px !important;
            color: #64748b !important; font-size: 12px !important;
            cursor: pointer !important; display: flex !important;
            align-items: center !important; justify-content: center !important;
          }
          .toast-corporate .toast-close:hover { background: rgba(100,116,139,0.2) !important; }
          @media (max-width: 640px) {
            .toast-corporate { 
              font-size: 0.8rem !important; 
              padding: 0.875rem 2.25rem 0.875rem 1rem !important; 
            }
            .toast-corporate .toast-close { 
              top: 4px !important; right: 6px !important; 
              width: 20px !important; height: 20px !important; 
            }
          }
          @media (max-width: 480px) {
            .toast-corporate { 
              font-size: 0.75rem !important; 
              padding: 0.75rem 2rem 0.75rem 0.875rem !important; 
            }
            .toast-corporate .toast-close { 
              top: 3px !important; right: 4px !important; 
              width: 18px !important; height: 18px !important; 
            }
          }

          /* Floating label fixes */
          .input-group {
            position: relative;
          }
          .floating-label {
            position: absolute;
            left: 40px;
            top: 16px;
            z-index: 10;
            padding: 0 4px;
            margin-left: -4px;
            transition: all 0.2s ease;
            pointer-events: none;
            color: rgb(100 116 139);
          }
          .input-group input {
            z-index: 1;
            padding-left: 48px;
            background: transparent;
          }
          .input-group.input-has-value .floating-label,
          .input-group.input-focused .floating-label {
            transform: translateY(-2rem) scale(0.85);
            z-index: 20;
            color: rgb(16 185 129);
            font-weight: 600;
            background: white;
            padding: 0 6px;
            margin-left: -6px;
          }
          /* Special case for email field with icon */
          .input-group:has(i.fas.fa-envelope) .floating-label {
            left: 40px;
          }
          /* Ensure input text aligns with label */
          .input-group:has(i.fas.fa-envelope) input {
            padding-left: 48px;
          }
        </style>
      `,
      );

      // Focus Management
      const focusTraps = new Map();

      function trapFocus(element) {
        const focusableElements = element.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',
        );
        const firstFocusable = focusableElements[0];
        const lastFocusable = focusableElements[focusableElements.length - 1];

        function handleTabKey(e) {
          if (e.key !== 'Tab') return;

          if (e.shiftKey) {
            if (document.activeElement === firstFocusable) {
              lastFocusable.focus();
              e.preventDefault();
            }
          } else {
            if (document.activeElement === lastFocusable) {
              firstFocusable.focus();
              e.preventDefault();
            }
          }
        }

        function handleEscapeKey(e) {
          if (e.key === 'Escape') {
            const modalId = element.id;
            hideModal(modalId);
          }
        }

        element.addEventListener('keydown', handleTabKey);
        element.addEventListener('keydown', handleEscapeKey);
        focusTraps.set(element, { handleTabKey, handleEscapeKey });
      }

      function removeFocusTrap(element) {
        const handlers = focusTraps.get(element);
        if (handlers) {
          element.removeEventListener('keydown', handlers.handleTabKey);
          element.removeEventListener('keydown', handlers.handleEscapeKey);
          focusTraps.delete(element);
        }
      }

      // Helper Functions
      function generateId() {
        return Math.random().toString(36).substr(2, 9);
      }

      function generateOTP() {
        return Math.floor(100000 + Math.random() * 900000).toString();
      }

      function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function isStrongPassword(password) {
        return (
          password.length >= 8 &&
          /(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(password)
        );
      }

      function getFromStorage(key, defaultValue = null) {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : defaultValue;
        } catch {
          return defaultValue;
        }
      }

      function saveToStorage(key, value) {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (error) {
          console.warn('Storage failed:', error);
        }
      }

      function removeFromStorage(key) {
        localStorage.removeItem(key);
      }

      function showError(element, message) {
        const errorDiv = element.parentElement.querySelector('.error-message');
        if (errorDiv) {
          errorDiv.textContent = message;
          errorDiv.classList.remove('hidden', 'opacity-0');
          errorDiv.classList.add('opacity-100');
          element.parentElement.classList.add('animate-bounce');
        }
      }

      function clearAllErrors() {
        document.querySelectorAll('.error-message').forEach((msg) => {
          msg.classList.add('hidden', 'opacity-0');
          msg.classList.remove('opacity-100');
          msg.textContent = '';
        });
        document
          .querySelectorAll('.animate-bounce')
          .forEach((el) => el.classList.remove('animate-bounce'));
      }

      // Account Security
      function isAccountLocked() {
        const attempts = getFromStorage('loginFailedAttempts', 0);
        const lastAttempt = getFromStorage('lastFailedAttempt');

        if (attempts >= MAX_LOGIN_ATTEMPTS && lastAttempt) {
          const timeSince = Date.now() - lastAttempt;
          const lockoutTime = LOCKOUT_MINUTES * 60 * 1000;
          if (timeSince < lockoutTime) {
            return Math.ceil((lockoutTime - timeSince) / 60000);
          }
        }
        return false;
      }

      // Login Process
      function tryLogin(email, password, rememberMe) {
        const users = getFromStorage('registeredUsers', {});

        if (users[email] === password) {
          // Success - clear failed attempts
          removeFromStorage('loginFailedAttempts');
          removeFromStorage('lastFailedAttempt');

          // Create session
          const sessionData = {
            email: email,
            loginTime: Date.now(),
            sessionId: `session_${generateId()}`,
            rememberMe: rememberMe,
          };
          saveToStorage('userSession', sessionData);

          // Handle remember me
          if (rememberMe) {
            saveToStorage('rememberedEmail', email);
          } else {
            removeFromStorage('rememberedEmail');
          }

          // Record successful login
          const history = getFromStorage('loginHistory', []);
          history.unshift({
            email: email,
            timestamp: Date.now(),
            success: true,
            userAgent: navigator.userAgent,
          });
          if (history.length > 10) history.pop();
          saveToStorage('loginHistory', history);

          return { success: true };
        } else {
          // Failed - record attempt
          const attempts = getFromStorage('loginFailedAttempts', 0) + 1;
          saveToStorage('loginFailedAttempts', attempts);
          saveToStorage('lastFailedAttempt', Date.now());

          // Record failed login
          const history = getFromStorage('loginHistory', []);
          history.unshift({
            email: email,
            timestamp: Date.now(),
            success: false,
            userAgent: navigator.userAgent,
          });
          if (history.length > 10) history.pop();
          saveToStorage('loginHistory', history);

          const remaining = MAX_LOGIN_ATTEMPTS - attempts;
          return {
            success: false,
            attempts: attempts,
            remaining: Math.max(0, remaining),
            locked: attempts >= MAX_LOGIN_ATTEMPTS,
          };
        }
      }

      // User Registration
      function registerUser(userData) {
        const users = getFromStorage('registeredUsers', {});
        const allUsers = getFromStorage('allUserData', {});

        if (users[userData.email]) {
          return { success: false, error: 'Email already exists' };
        }

        users[userData.email] = userData.password;
        saveToStorage('registeredUsers', users);

        const fullUserData = {
          ...userData,
          registrationDate: Date.now(),
          userId: `user_${generateId()}`,
          isEmailVerified: true,
          lastLogin: null,
        };

        allUsers[userData.email] = fullUserData;
        saveToStorage('allUserData', allUsers);

        // Record registration
        const history = getFromStorage('registrationHistory', []);
        history.unshift({
          email: userData.email,
          fullName: userData.fullName,
          timestamp: Date.now(),
          userAgent: navigator.userAgent,
        });
        if (history.length > 50) history.pop();
        saveToStorage('registrationHistory', history);

        return { success: true };
      }

      // OTP Functions
      function createOTP(email) {
        const otp = generateOTP();
        const otpData = {
          otp: otp,
          email: email,
          timestamp: Date.now(),
          expires: Date.now() + OTP_EXPIRY_MINUTES * 60 * 1000,
        };

        saveToStorage('currentOTP', otpData);
        removeFromStorage('otpFailedAttempts');

        return otp;
      }

      function verifyOTP(inputOTP) {
        const storedData = getFromStorage('currentOTP');
        if (!storedData) {
          return { success: false, error: 'OTP session expired' };
        }

        if (Date.now() > storedData.expires) {
          removeFromStorage('currentOTP');
          return { success: false, error: 'OTP has expired' };
        }

        if (inputOTP === storedData.otp) {
          removeFromStorage('currentOTP');
          removeFromStorage('otpFailedAttempts');

          const verificationData = {
            email: storedData.email,
            verified: true,
            timestamp: Date.now(),
            resetToken: `reset_${generateId()}`,
          };
          saveToStorage('passwordResetVerified', verificationData);

          return { success: true, verificationData: verificationData };
        } else {
          const attempts = getFromStorage('otpFailedAttempts', 0) + 1;
          saveToStorage('otpFailedAttempts', attempts);

          if (attempts >= 3) {
            removeFromStorage('currentOTP');
            removeFromStorage('otpFailedAttempts');
            return {
              success: false,
              error: 'Too many failed attempts',
              maxReached: true,
            };
          }

          return {
            success: false,
            error: `Invalid code. ${3 - attempts} attempts remaining`,
            remaining: 3 - attempts,
          };
        }
      }

      function canResendOTP() {
        const lastResend = getFromStorage('lastOTPResend');
        const resendCount = getFromStorage('otpResendCount', 0);

        if (resendCount >= 3) {
          return { canResend: false, reason: 'Maximum resends reached' };
        }

        if (lastResend && Date.now() - lastResend < 60000) {
          const remaining = Math.ceil(
            (60000 - (Date.now() - lastResend)) / 1000,
          );
          return {
            canResend: false,
            reason: 'Cooldown active',
            remaining: remaining,
          };
        }

        return { canResend: true };
      }

      function resendOTP(email) {
        const resendCheck = canResendOTP();
        if (!resendCheck.canResend) {
          return { success: false, ...resendCheck };
        }

        const newOTP = createOTP(email);
        const resendCount = getFromStorage('otpResendCount', 0) + 1;

        saveToStorage('otpResendCount', resendCount);
        saveToStorage('lastOTPResend', Date.now());

        return { success: true, otp: newOTP };
      }

      // UI Functions
      function togglePassword(passwordId, eyeOpenId, eyeClosedId) {
        const passwordInput = document.getElementById(passwordId);
        const eyeOpen = document.getElementById(eyeOpenId);
        const eyeClosed = document.getElementById(eyeClosedId);
        const toggleButton = eyeOpen.closest('button');

        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          eyeOpen.classList.add('hidden');
          eyeClosed.classList.remove('hidden');
          toggleButton.setAttribute('aria-pressed', 'true');
          toggleButton.setAttribute('aria-label', 'Hide password');
        } else {
          passwordInput.type = 'password';
          eyeOpen.classList.remove('hidden');
          eyeClosed.classList.add('hidden');
          toggleButton.setAttribute('aria-pressed', 'false');
          toggleButton.setAttribute('aria-label', 'Show password');
        }
      }

      function showModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('hidden', 'opacity-0');
        modal.classList.add('flex', 'opacity-100');

        // Focus management for accessibility
        const firstFocusable = modal.querySelector(
          'input, button, [tabindex="0"]',
        );
        if (firstFocusable) {
          setTimeout(() => firstFocusable.focus(), 100);
        }

        // Store the element that opened the modal for focus restoration
        modal.dataset.previousFocus = document.activeElement.id || '';

        // Trap focus within modal
        trapFocus(modal);
      }

      function hideModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.add('hidden', 'opacity-0');
        modal.classList.remove('flex', 'opacity-100');

        // Restore focus to the element that opened the modal
        const previousFocusId = modal.dataset.previousFocus;
        if (previousFocusId) {
          const previousElement = document.getElementById(previousFocusId);
          if (previousElement) {
            previousElement.focus();
          }
        }

        // Remove focus trap
        removeFocusTrap(modal);
      }

      function setButtonLoading(button, isLoading, loadingText = 'Loading...') {
        if (isLoading) {
          button.dataset.originalText = button.innerHTML;
          button.textContent = loadingText;
          button.disabled = true;
        } else {
          button.innerHTML = button.dataset.originalText;
          button.disabled = false;
        }
      }

      // Form Setup
      function setupFloatingLabels(container = document) {
        container.querySelectorAll('.input-group').forEach((group) => {
          const input = group.querySelector('input');
          if (!input) return;

          // Handle remembered email
          if (input.id === 'email') {
            const savedEmail = getFromStorage('rememberedEmail');
            if (savedEmail) {
              input.value = savedEmail;
              group.classList.add('input-has-value');
              const label = group.querySelector('.floating-label');
              if (label) {
                label.classList.add('-translate-y-6', 'scale-90');
              }
              document.getElementById('rememberMe').checked = true;
            }

            // Handle draft email
            input.addEventListener('input', () => {
              if (input.value) {
                saveToStorage('draftEmail', input.value);
              } else {
                removeFromStorage('draftEmail');
              }
            });

            const draftEmail = getFromStorage('draftEmail');
            if (draftEmail && !input.value) {
              input.value = draftEmail;
              group.classList.add('input-has-value');
              const label = group.querySelector('.floating-label');
              if (label) {
                label.classList.add('-translate-y-6', 'scale-90');
              }
            }
          }

          // Handle initial state for any input with value
          if (input.value.length > 0) {
            group.classList.add('input-has-value');
            const label = group.querySelector('.floating-label');
            if (label) {
              label.classList.add('-translate-y-6', 'scale-90');
            }
          }

          input.addEventListener('focus', () => {
            group.classList.add('input-focused');
            const label = group.querySelector('.floating-label');
            if (label) {
              label.classList.add(
                '-translate-y-6',
                'scale-90',
                'text-emerald-600',
                'font-semibold',
              );
            }
          });
          input.addEventListener('blur', () => {
            group.classList.remove('input-focused');
            const hasValue = input.value.length > 0;
            group.classList.toggle('input-has-value', hasValue);
            const label = group.querySelector('.floating-label');
            if (label && !hasValue) {
              label.classList.remove(
                '-translate-y-6',
                'scale-90',
                'text-emerald-600',
                'font-semibold',
              );
            }
          });
          input.addEventListener('input', () => {
            const hasValue = input.value.length > 0;
            group.classList.toggle('input-has-value', hasValue);
            const label = group.querySelector('.floating-label');
            if (label) {
              if (hasValue) {
                label.classList.add(
                  '-translate-y-6',
                  'scale-90',
                  'text-emerald-600',
                  'font-semibold',
                );
              } else {
                label.classList.remove(
                  '-translate-y-6',
                  'scale-90',
                  'text-emerald-600',
                  'font-semibold',
                );
              }
            }
          });
        });
      }

      // OTP Input Setup
      function setupOTPInputs() {
        const otpInputs = document.querySelectorAll('.otp-input');

        otpInputs.forEach((input, index) => {
          input.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');

            if (e.target.value.length === 1 && index < otpInputs.length - 1) {
              otpInputs[index + 1].focus();
            }
          });

          input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && !e.target.value && index > 0) {
              otpInputs[index - 1].focus();
            }
          });

          input.addEventListener('paste', (e) => {
            e.preventDefault();
            const paste = (e.clipboardData || window.clipboardData).getData(
              'text',
            );
            const pasteData = paste.replace(/[^0-9]/g, '').slice(0, OTP_LENGTH);

            pasteData.split('').forEach((char, i) => {
              if (index + i < otpInputs.length) {
                otpInputs[index + i].value = char;
              }
            });

            const nextIndex = Math.min(
              index + pasteData.length,
              otpInputs.length - 1,
            );
            otpInputs[nextIndex].focus();
          });
        });
      }

      // Cleanup expired data
      function cleanupExpiredData() {
        const otpData = getFromStorage('currentOTP');
        if (otpData && Date.now() > otpData.expires) {
          removeFromStorage('currentOTP');
          removeFromStorage('otpFailedAttempts');
          removeFromStorage('otpResendCount');
        }

        const resetData = getFromStorage('passwordResetVerified');
        if (resetData && Date.now() - resetData.timestamp > 10 * 60 * 1000) {
          removeFromStorage('passwordResetVerified');
        }

        const lastAttempt = getFromStorage('lastFailedAttempt');
        if (
          lastAttempt &&
          Date.now() - lastAttempt > LOCKOUT_MINUTES * 60 * 1000
        ) {
          removeFromStorage('loginFailedAttempts');
          removeFromStorage('lastFailedAttempt');
        }
      }

      // When page loads
      document.addEventListener('DOMContentLoaded', function () {
        // Check for valid session
        const session = getFromStorage('userSession');
        if (session) {
          const sessionAge = Date.now() - session.loginTime;
          const maxAge = session.rememberMe
            ? 30 * 24 * 60 * 60 * 1000
            : 24 * 60 * 60 * 1000;

          if (sessionAge < maxAge) {
            console.log('Valid session found');
          } else {
            removeFromStorage('userSession');
          }
        }

        // Cleanup expired data
        cleanupExpiredData();

        // Setup UI
        setupFloatingLabels();
        setupOTPInputs();

        // Login form
        document
          .getElementById('loginForm')
          .addEventListener('submit', function (e) {
            e.preventDefault();
            clearAllErrors();

            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const submitButton = e.target.querySelector(
              'button[type="submit"]',
            );

            const lockoutTime = isAccountLocked();
            if (lockoutTime) {
              showErrorToast(
                `Too many failed attempts. Please try again in ${lockoutTime} minutes.`,
              );
              return;
            }

            let hasError = false;
            if (!isValidEmail(email)) {
              showError(
                document.getElementById('email'),
                'Please enter a valid email address',
              );
              hasError = true;
            }

            if (password.length < 6) {
              showError(
                document.getElementById('password'),
                'Password must be at least 6 characters',
              );
              hasError = true;
            }

            if (hasError) {
              setTimeout(() => clearAllErrors(), 500);
              return;
            }

            setButtonLoading(submitButton, true, 'Signing In...');

            setTimeout(() => {
              const result = tryLogin(email, password, rememberMe);

              if (result.success) {
                showSuccessToast('Login successful! Welcome back.');

                // Clear form fields after successful login (except if remember me is checked)
                if (!rememberMe) {
                  // Clear email field
                  const emailInput = document.getElementById('email');
                  const emailGroup = emailInput.parentElement;
                  const emailLabel =
                    emailGroup.querySelector('.floating-label');

                  emailInput.value = '';
                  emailGroup.classList.remove('input-has-value');
                  if (emailLabel) {
                    emailLabel.classList.remove(
                      '-translate-y-6',
                      'scale-90',
                      'text-emerald-600',
                      'font-semibold',
                    );
                  }

                  // Also clear draft email from storage
                  removeFromStorage('draftEmail');
                }

                // Always clear password field for security
                const passwordInput = document.getElementById('password');
                const passwordGroup = passwordInput.parentElement;
                const passwordLabel =
                  passwordGroup.querySelector('.floating-label');

                passwordInput.value = '';
                passwordGroup.classList.remove('input-has-value');
                if (passwordLabel) {
                  passwordLabel.classList.remove(
                    '-translate-y-6',
                    'scale-90',
                    'text-emerald-600',
                    'font-semibold',
                  );
                }

                // Reset remember me checkbox if not used
                if (!rememberMe) {
                  document.getElementById('rememberMe').checked = false;
                }
              } else {
                if (result.locked) {
                  showErrorToast(
                    'Too many failed attempts. Account temporarily locked for 15 minutes.',
                  );
                } else {
                  showErrorToast(
                    `Invalid credentials. ${result.remaining} attempts remaining before lockout.`,
                  );
                }
              }

              setButtonLoading(submitButton, false);
            }, 1500);
          });

        // Password toggle
        document
          .getElementById('togglePassword')
          .addEventListener('click', () => {
            togglePassword('password', 'eyeOpen', 'eyeClosed');
          });

        document
          .getElementById('toggleSignUpPassword')
          .addEventListener('click', () => {
            togglePassword(
              'signUpPassword',
              'signUpEyeOpen',
              'signUpEyeClosed',
            );
          });

        document
          .getElementById('toggleSignUpConfirmPassword')
          .addEventListener('click', () => {
            togglePassword(
              'signUpConfirmPassword',
              'signUpConfirmEyeOpen',
              'signUpConfirmEyeClosed',
            );
          });

        // Forgot password
        document
          .getElementById('forgotPassword')
          .addEventListener('click', function () {
            const email = document.getElementById('email').value.trim();
            if (!isValidEmail(email)) {
              showErrorToast('Please enter your email address first');
              document.getElementById('email').focus();
              return;
            }

            const button = document.getElementById('forgotPassword');
            setButtonLoading(button, true, 'Sending...');

            setTimeout(() => {
              const otp = createOTP(email);

              console.log('Generated OTP:', otp);
              showInfoToast(
                `OTP sent to ${email}! For testing purposes, your OTP is: ${otp} (In real app, this would be sent via email)`,
              );

              showModal('otpModal');
              setTimeout(
                () => document.querySelector('.otp-input').focus(),
                100,
              );

              setButtonLoading(button, false);
            }, 1500);
          });

        // OTP verification
        document
          .getElementById('verifyOtp')
          .addEventListener('click', function () {
            const otpInputs = document.querySelectorAll('.otp-input');
            const otp = Array.from(otpInputs)
              .map((input) => input.value)
              .join('');

            if (otp.length !== OTP_LENGTH) {
              showWarningToast(
                `Please enter the complete ${OTP_LENGTH}-digit code`,
              );
              return;
            }

            const button = document.getElementById('verifyOtp');
            setButtonLoading(button, true, 'Verifying...');

            setTimeout(() => {
              const result = verifyOTP(otp);

              if (result.success) {
                showSuccessToast(
                  'OTP verified successfully! You can now reset your password.',
                );
                hideModal('otpModal');
                otpInputs.forEach((input) => (input.value = ''));
                console.log(
                  'Reset token generated:',
                  result.verificationData.resetToken,
                );
              } else {
                showErrorToast(result.error);
                if (result.maxReached) {
                  hideModal('otpModal');
                } else {
                  otpInputs.forEach((input) => (input.value = ''));
                  otpInputs[0].focus();
                }
              }

              setButtonLoading(button, false);
            }, 1000);
          });

        // OTP resend
        document
          .getElementById('resendCode')
          .addEventListener('click', function () {
            const email = document.getElementById('email').value.trim();
            const button = document.getElementById('resendCode');

            const resendCheck = canResendOTP();
            if (!resendCheck.canResend) {
              if (resendCheck.remaining) {
                showWarningToast(
                  `Please wait ${resendCheck.remaining} seconds before requesting a new code.`,
                );
              } else {
                showWarningToast(resendCheck.reason);
              }
              return;
            }

            setButtonLoading(button, true, 'Sending...');

            setTimeout(() => {
              const result = resendOTP(email);

              if (result.success) {
                console.log('New OTP generated:', result.otp);
                showSuccessToast(
                  `New OTP sent to ${email}! For testing: ${result.otp}`,
                );

                document
                  .querySelectorAll('.otp-input')
                  .forEach((input) => (input.value = ''));
                document.querySelector('.otp-input').focus();
              } else {
                showErrorToast(result.reason);
              }

              setButtonLoading(button, false);
            }, 2000);
          });

        // Close OTP modal
        document
          .getElementById('closeModal')
          .addEventListener('click', () => hideModal('otpModal'));

        // Sign up modal
        document.getElementById('showSignUp').addEventListener('click', () => {
          showModal('signUpModal');
          document.getElementById('signUpFullName').focus();
        });

        document
          .getElementById('showLogin')
          .addEventListener('click', () => hideModal('signUpModal'));
        document
          .getElementById('closeSignUpModal')
          .addEventListener('click', () => hideModal('signUpModal'));

        // Sign up form
        document
          .getElementById('signUpForm')
          .addEventListener('submit', function (e) {
            e.preventDefault();
            clearAllErrors();

            const fullName = document
              .getElementById('signUpFullName')
              .value.trim();
            const email = document.getElementById('signUpEmail').value.trim();
            const password = document.getElementById('signUpPassword').value;
            const confirmPassword = document.getElementById(
              'signUpConfirmPassword',
            ).value;
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const submitButton = e.target.querySelector(
              'button[type="submit"]',
            );

            let hasError = false;

            if (fullName.length < 2) {
              showError(
                document.getElementById('signUpFullName'),
                'Please enter your full name (at least 2 characters)',
              );
              hasError = true;
            }

            if (!isValidEmail(email)) {
              showError(
                document.getElementById('signUpEmail'),
                'Please enter a valid email address',
              );
              hasError = true;
            } else {
              const existingUsers = getFromStorage('registeredUsers', {});
              if (existingUsers[email]) {
                showError(
                  document.getElementById('signUpEmail'),
                  'An account with this email already exists',
                );
                hasError = true;
              }
            }

            if (!isStrongPassword(password)) {
              showError(
                document.getElementById('signUpPassword'),
                'Password must be at least 8 characters with uppercase, lowercase, and number',
              );
              hasError = true;
            }

            if (password !== confirmPassword) {
              showError(
                document.getElementById('signUpConfirmPassword'),
                'Passwords do not match',
              );
              hasError = true;
            }

            if (!agreeTerms) {
              showWarningToast(
                'Please agree to the Terms of Service and Privacy Policy',
              );
              hasError = true;
            }

            if (hasError) {
              setTimeout(() => clearAllErrors(), 500);
              return;
            }

            setButtonLoading(submitButton, true, 'Creating Account...');

            setTimeout(() => {
              const userData = { fullName, email, password };
              const result = registerUser(userData);

              if (result.success) {
                showSuccessToast(
                  `Account created successfully! Welcome ${fullName}! You can now sign in with your email and password.`,
                );

                document.getElementById('email').value = email;
                document
                  .querySelector('#email')
                  .parentElement.classList.add('input-has-value');

                hideModal('signUpModal');
                document.getElementById('signUpForm').reset();
                document
                  .querySelectorAll('#signUpModal .input-group')
                  .forEach((group) => {
                    group.classList.remove('input-has-value');
                  });
              } else {
                showErrorToast(`Registration failed: ${result.error}`);
              }

              setButtonLoading(submitButton, false);
            }, 2000);
          });

        // Modal backdrop clicks
        document.getElementById('otpModal').addEventListener('click', (e) => {
          if (e.target.id === 'otpModal') hideModal('otpModal');
        });

        document
          .getElementById('signUpModal')
          .addEventListener('click', (e) => {
            if (e.target.id === 'signUpModal') hideModal('signUpModal');
          });

        // Setup floating labels for sign up modal
        setupFloatingLabels(document.getElementById('signUpModal'));

        // Prevent double-tap zoom on iOS
        let lastTouchEnd = 0;
        document.addEventListener(
          'touchend',
          (event) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
              event.preventDefault();
            }
            lastTouchEnd = now;
          },
          false,
        );
      });
    </script>
  </body>
</html>
